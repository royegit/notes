
# MySQL 优化思路
#### 1、硬件优化
腾讯.CPU 64位CPU 一台机器8-16颗CPU
百度：mem（内存） 96G - 128G。一台服务器会跑3-4个实例。在那种大公司：不是门户网站的一般是32G - 64G的内存，跑两个实例。然后CPU一般是2-4颗。
disk（硬盘）数量越多越好。性能ssd（做高并发业务）优于sas（做普通业务）优于sata（用做线下）。如果是高并发的业务，选择ssd
raid 4块盘：RAID0 优于 RAID10 优于 RAID5 优于 RAID1。
网卡。多块网卡bond（多个网卡合成一块提升性能） ，以及buffer,tcp优化

#### 软件优化
操作系统：x86_64,
软件：mysql 编译的优化

#### 2、my.cnf 里参数的优化
注意：my.cnf 里参数优化的幅度很小。大部分是架构的优化，以及SQL语句的优化。
思想：
监控：生产参数是一般情况下参数。
命令：show global status\G;
监控调试工具：mysqlreport ,通过它
tuning-primer 工具


#### 3、SQL语句的优化

a、索引优化
    1）白名单机制--百度，项目开发时DBA要及时参与，减少上线后慢SQL的数量。
    抓出慢SQL，配置my.cnf
    long_query_time = 2
    log-slow-queries = /data/3306/slow-log.log
    按天轮询：slow-log.log
    
     2) 慢查询日志分析工具---mysqlsla 最推荐的工具
    mysqldumpslow,mysqlsla,myprofi,mysql-explain-slow-log,mysqllogfilter 比较
    
    3）每天晚上0点定时分析慢查询，发到核心开发，DBA分析，及高级运维，CTO的邮箱里。
    DBA分析给出优化建议-->核心开发确认更爱-->DBA线上操作处理。

b.大的复杂的SQL语句拆分成多个小的SQL语句。
    子查询，JOIN连表查询，某个表4000万条数据记录时无论怎么优化都慢

c. 数据库是存储数据的地方，但是不是计算数据的地方。
    对数据计算，应用类处理，都要拿到前端应用解决。禁止在数据库上处理。

d.搜索功能，like '%老男孩%'（也优化不了） ，一般不要用MySQL数据库，
    

#### 4、架构的优化
#### 5、流程，制度，安全优化

### 一、在业务中有很多 like 语句时

1、从业务上实现用户登陆后在搜索，这样减少搜索次数，从而减轻数据库服务压力。
2、如果有大量频繁的搜索，一般是爬虫在趴你的网站，分析WEB日志IP封掉之(AWSTATS)
3、配置多个主从同步，程序上实现读写分离（最好让 LIKE '%杜冷丁%' 这样的查询去从库查询），减轻主库读写压力。
4、在数据库前端加上 memcached 缓存服务器。
5、LIKE '%杜冷丁%' 的语句，一般在mysql里很难优化，可以通过搜索服务Sphinx或者ElasticSearch
6、还可以用c,ruby开发程序，实现每日读库计算搜索索引，保存在服务器上提供搜索，然后，每5分钟多一个从库做一次增量。这是大公司针对站内搜索采用的比较好的方案。
短期来看，我更倾向于1，2的方案。简单，可实施，3，4是后期要发展的目标，

如果前端有人爬站，封掉IP就好了。



